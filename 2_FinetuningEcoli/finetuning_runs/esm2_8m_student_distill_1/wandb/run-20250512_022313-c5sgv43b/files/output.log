2025-05-12 02:23:13,988 INFO: Training configuration saved to runs/esm2_8m_student_distill_1/train_config.yaml
2025-05-12 02:23:14,329 INFO: Found potential target modules: ['esm.encoder.layer.0.attention.self.key', 'esm.encoder.layer.0.attention.self.value', 'esm.encoder.layer.1.attention.self.key', 'esm.encoder.layer.1.attention.self.value', 'esm.encoder.layer.2.attention.self.key', 'esm.encoder.layer.2.attention.self.value', 'esm.encoder.layer.3.attention.self.key', 'esm.encoder.layer.3.attention.self.value', 'esm.encoder.layer.4.attention.self.key', 'esm.encoder.layer.4.attention.self.value', 'esm.encoder.layer.5.attention.self.key', 'esm.encoder.layer.5.attention.self.value']
2025-05-12 02:23:14,329 INFO: Using target module names: ['value', 'key']
2025-05-12 02:23:14,330 INFO: Parameters requiring gradients before LoRA: 7840794
2025-05-12 02:23:14,348 INFO: Trainable parameter: base_model.model.esm.encoder.layer.0.attention.self.key.lora_A.default.weight (shape: torch.Size([8, 320]))
2025-05-12 02:23:14,348 INFO: Trainable parameter: base_model.model.esm.encoder.layer.0.attention.self.key.lora_B.default.weight (shape: torch.Size([320, 8]))
2025-05-12 02:23:14,348 INFO: Trainable parameter: base_model.model.esm.encoder.layer.0.attention.self.value.lora_A.default.weight (shape: torch.Size([8, 320]))
2025-05-12 02:23:14,348 INFO: Trainable parameter: base_model.model.esm.encoder.layer.0.attention.self.value.lora_B.default.weight (shape: torch.Size([320, 8]))
2025-05-12 02:23:14,348 INFO: Trainable parameter: base_model.model.esm.encoder.layer.1.attention.self.key.lora_A.default.weight (shape: torch.Size([8, 320]))
2025-05-12 02:23:14,349 INFO: Trainable parameter: base_model.model.esm.encoder.layer.1.attention.self.key.lora_B.default.weight (shape: torch.Size([320, 8]))
2025-05-12 02:23:14,349 INFO: Trainable parameter: base_model.model.esm.encoder.layer.1.attention.self.value.lora_A.default.weight (shape: torch.Size([8, 320]))
2025-05-12 02:23:14,349 INFO: Trainable parameter: base_model.model.esm.encoder.layer.1.attention.self.value.lora_B.default.weight (shape: torch.Size([320, 8]))
2025-05-12 02:23:14,349 INFO: Trainable parameter: base_model.model.esm.encoder.layer.2.attention.self.key.lora_A.default.weight (shape: torch.Size([8, 320]))
2025-05-12 02:23:14,349 INFO: Trainable parameter: base_model.model.esm.encoder.layer.2.attention.self.key.lora_B.default.weight (shape: torch.Size([320, 8]))
2025-05-12 02:23:14,349 INFO: Trainable parameter: base_model.model.esm.encoder.layer.2.attention.self.value.lora_A.default.weight (shape: torch.Size([8, 320]))
2025-05-12 02:23:14,350 INFO: Trainable parameter: base_model.model.esm.encoder.layer.2.attention.self.value.lora_B.default.weight (shape: torch.Size([320, 8]))
2025-05-12 02:23:14,350 INFO: Trainable parameter: base_model.model.esm.encoder.layer.3.attention.self.key.lora_A.default.weight (shape: torch.Size([8, 320]))
2025-05-12 02:23:14,350 INFO: Trainable parameter: base_model.model.esm.encoder.layer.3.attention.self.key.lora_B.default.weight (shape: torch.Size([320, 8]))
2025-05-12 02:23:14,350 INFO: Trainable parameter: base_model.model.esm.encoder.layer.3.attention.self.value.lora_A.default.weight (shape: torch.Size([8, 320]))
2025-05-12 02:23:14,350 INFO: Trainable parameter: base_model.model.esm.encoder.layer.3.attention.self.value.lora_B.default.weight (shape: torch.Size([320, 8]))
2025-05-12 02:23:14,350 INFO: Trainable parameter: base_model.model.esm.encoder.layer.4.attention.self.key.lora_A.default.weight (shape: torch.Size([8, 320]))
2025-05-12 02:23:14,350 INFO: Trainable parameter: base_model.model.esm.encoder.layer.4.attention.self.key.lora_B.default.weight (shape: torch.Size([320, 8]))
2025-05-12 02:23:14,351 INFO: Trainable parameter: base_model.model.esm.encoder.layer.4.attention.self.value.lora_A.default.weight (shape: torch.Size([8, 320]))
2025-05-12 02:23:14,351 INFO: Trainable parameter: base_model.model.esm.encoder.layer.4.attention.self.value.lora_B.default.weight (shape: torch.Size([320, 8]))
2025-05-12 02:23:14,351 INFO: Trainable parameter: base_model.model.esm.encoder.layer.5.attention.self.key.lora_A.default.weight (shape: torch.Size([8, 320]))
2025-05-12 02:23:14,351 INFO: Trainable parameter: base_model.model.esm.encoder.layer.5.attention.self.key.lora_B.default.weight (shape: torch.Size([320, 8]))
2025-05-12 02:23:14,351 INFO: Trainable parameter: base_model.model.esm.encoder.layer.5.attention.self.value.lora_A.default.weight (shape: torch.Size([8, 320]))
2025-05-12 02:23:14,351 INFO: Trainable parameter: base_model.model.esm.encoder.layer.5.attention.self.value.lora_B.default.weight (shape: torch.Size([320, 8]))
2025-05-12 02:23:14,352 INFO: Trainable parameter: base_model.model.lm_head.bias (shape: torch.Size([33]))
2025-05-12 02:23:14,352 INFO: Trainable parameter: base_model.model.lm_head.dense.weight (shape: torch.Size([320, 320]))
2025-05-12 02:23:14,352 INFO: Trainable parameter: base_model.model.lm_head.dense.bias (shape: torch.Size([320]))
2025-05-12 02:23:14,352 INFO: Trainable parameter: base_model.model.lm_head.layer_norm.weight (shape: torch.Size([320]))
2025-05-12 02:23:14,352 INFO: Trainable parameter: base_model.model.lm_head.layer_norm.bias (shape: torch.Size([320]))
2025-05-12 02:23:14,353 INFO: LoRA integration complete. Trainable parameters: 164833 (2.09% of total)
2025-05-12 02:23:14,393 INFO: Loaded 7489 training and 1404 evaluation sequences.
2025-05-12 02:23:14,394 INFO: Adjusted max_length to 1024 to be a multiple of 8
2025-05-12 02:23:14,394 INFO: Using masked language modeling (MLM) data collator for ESM model.
2025-05-12 02:23:14,395 INFO: Number of trainable parameters before training: 164833
No label_names provided for model class `PeftModelForCausalLM`. Since `PeftModel` hides base models input arguments, if label_names is not given, label_names can't be set automatically within `Trainer`. Note that empty label_names list will be used instead.
[34m[1mwandb[0m: [33mWARNING[0m The `run_name` is currently set to the same value as `TrainingArguments.output_dir`. If this was not intended, please specify a different run name by setting the `TrainingArguments.run_name` parameter.
  0%|                                                                                                          | 0/60 [00:00<?, ?it/s]/home/sdowell/miniconda3/envs/thesis/lib/python3.13/site-packages/torch/nn/parallel/_functions.py:70: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn(
  5%|████▉                                                                                             | 3/60 [00:31<08:20,  8.78s/it]/home/sdowell/miniconda3/envs/thesis/lib/python3.13/site-packages/torch/nn/parallel/_functions.py:70: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
{'loss': 2.4848, 'grad_norm': 18452.240234375, 'learning_rate': 1.2000000000000002e-06, 'epoch': 0.81}
  warnings.warn(                                                                                                                      
{'eval_loss': 2.436514139175415, 'eval_runtime': 2.7752, 'eval_samples_per_second': 505.901, 'eval_steps_per_second': 3.964, 'epoch': 0.81}
 10%|█████████▊                                                                                        | 6/60 [00:59<08:01,  8.91s/it]/home/sdowell/miniconda3/envs/thesis/lib/python3.13/site-packages/torch/nn/parallel/_functions.py:70: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
{'loss': 2.4886, 'grad_norm': 19238.51953125, 'learning_rate': 2.4000000000000003e-06, 'epoch': 1.81}
  warnings.warn(                                                                                                                      
{'eval_loss': 2.4389638900756836, 'eval_runtime': 2.6828, 'eval_samples_per_second': 523.332, 'eval_steps_per_second': 4.1, 'epoch': 1.81}
 15%|██████████████▋                                                                                   | 9/60 [01:27<07:36,  8.95s/it]/home/sdowell/miniconda3/envs/thesis/lib/python3.13/site-packages/torch/nn/parallel/_functions.py:70: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
{'loss': 2.4901, 'grad_norm': 19036.751953125, 'learning_rate': 3.6e-06, 'epoch': 2.81}
  warnings.warn(                                                                                                                      
{'eval_loss': 2.4385313987731934, 'eval_runtime': 2.6688, 'eval_samples_per_second': 526.075, 'eval_steps_per_second': 4.122, 'epoch': 2.81}
 20%|███████████████████▍                                                                             | 12/60 [01:56<07:10,  8.97s/it]/home/sdowell/miniconda3/envs/thesis/lib/python3.13/site-packages/torch/nn/parallel/_functions.py:70: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
{'loss': 2.4878, 'grad_norm': 17836.62109375, 'learning_rate': 4.800000000000001e-06, 'epoch': 3.81}
  warnings.warn(                                                                                                                      
{'eval_loss': 2.43100905418396, 'eval_runtime': 2.6935, 'eval_samples_per_second': 521.261, 'eval_steps_per_second': 4.084, 'epoch': 3.81}
 25%|████████████████████████▎                                                                        | 15/60 [02:24<06:43,  8.96s/it]/home/sdowell/miniconda3/envs/thesis/lib/python3.13/site-packages/torch/nn/parallel/_functions.py:70: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
{'loss': 2.4889, 'grad_norm': 18849.63671875, 'learning_rate': 6e-06, 'epoch': 4.81}
  warnings.warn(                                                                                                                      
{'eval_loss': 2.4326322078704834, 'eval_runtime': 2.6688, 'eval_samples_per_second': 526.076, 'eval_steps_per_second': 4.122, 'epoch': 4.81}
 30%|█████████████████████████████                                                                    | 18/60 [02:53<06:16,  8.95s/it]/home/sdowell/miniconda3/envs/thesis/lib/python3.13/site-packages/torch/nn/parallel/_functions.py:70: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
{'loss': 2.4888, 'grad_norm': 17735.765625, 'learning_rate': 7.2e-06, 'epoch': 5.81}
  warnings.warn(                                                                                                                      
{'eval_loss': 2.4386966228485107, 'eval_runtime': 2.688, 'eval_samples_per_second': 522.32, 'eval_steps_per_second': 4.092, 'epoch': 5.81}
 35%|█████████████████████████████████▉                                                               | 21/60 [03:21<05:47,  8.92s/it]/home/sdowell/miniconda3/envs/thesis/lib/python3.13/site-packages/torch/nn/parallel/_functions.py:70: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
{'loss': 2.4863, 'grad_norm': 17696.04296875, 'learning_rate': 8.400000000000001e-06, 'epoch': 6.81}
  warnings.warn(                                                                                                                      
{'eval_loss': 2.436340808868408, 'eval_runtime': 2.644, 'eval_samples_per_second': 531.021, 'eval_steps_per_second': 4.16, 'epoch': 6.81}
 40%|██████████████████████████████████████▊                                                          | 24/60 [03:49<05:21,  8.94s/it]/home/sdowell/miniconda3/envs/thesis/lib/python3.13/site-packages/torch/nn/parallel/_functions.py:70: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
{'loss': 2.4832, 'grad_norm': 17445.392578125, 'learning_rate': 9.600000000000001e-06, 'epoch': 7.81}
  warnings.warn(                                                                                                                      
{'eval_loss': 2.4340503215789795, 'eval_runtime': 2.6733, 'eval_samples_per_second': 525.186, 'eval_steps_per_second': 4.115, 'epoch': 7.81}
 45%|███████████████████████████████████████████▋                                                     | 27/60 [04:17<04:54,  8.93s/it]/home/sdowell/miniconda3/envs/thesis/lib/python3.13/site-packages/torch/nn/parallel/_functions.py:70: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
{'loss': 2.4842, 'grad_norm': 18435.169921875, 'learning_rate': 1.08e-05, 'epoch': 8.81}
  warnings.warn(                                                                                                                      
{'eval_loss': 2.429624557495117, 'eval_runtime': 2.6503, 'eval_samples_per_second': 529.761, 'eval_steps_per_second': 4.151, 'epoch': 8.81}
 50%|████████████████████████████████████████████████▌                                                | 30/60 [04:46<04:27,  8.92s/it]/home/sdowell/miniconda3/envs/thesis/lib/python3.13/site-packages/torch/nn/parallel/_functions.py:70: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
{'loss': 2.4818, 'grad_norm': 18334.2578125, 'learning_rate': 1.2e-05, 'epoch': 9.81}
  warnings.warn(                                                                                                                      
{'eval_loss': 2.426617383956909, 'eval_runtime': 2.7056, 'eval_samples_per_second': 518.932, 'eval_steps_per_second': 4.066, 'epoch': 9.81}
 55%|█████████████████████████████████████████████████████▎                                           | 33/60 [05:14<04:01,  8.93s/it]/home/sdowell/miniconda3/envs/thesis/lib/python3.13/site-packages/torch/nn/parallel/_functions.py:70: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
{'loss': 2.483, 'grad_norm': 18196.779296875, 'learning_rate': 1.32e-05, 'epoch': 10.81}
  warnings.warn(                                                                                                                      
{'eval_loss': 2.4333784580230713, 'eval_runtime': 2.6464, 'eval_samples_per_second': 530.542, 'eval_steps_per_second': 4.157, 'epoch': 10.81}
 60%|██████████████████████████████████████████████████████████▏                                      | 36/60 [05:42<03:34,  8.93s/it]/home/sdowell/miniconda3/envs/thesis/lib/python3.13/site-packages/torch/nn/parallel/_functions.py:70: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
{'loss': 2.4773, 'grad_norm': 17511.90625, 'learning_rate': 1.44e-05, 'epoch': 11.81}
  warnings.warn(                                                                                                                      
{'eval_loss': 2.424710273742676, 'eval_runtime': 2.6717, 'eval_samples_per_second': 525.516, 'eval_steps_per_second': 4.117, 'epoch': 11.81}
 65%|███████████████████████████████████████████████████████████████                                  | 39/60 [06:10<03:07,  8.93s/it]/home/sdowell/miniconda3/envs/thesis/lib/python3.13/site-packages/torch/nn/parallel/_functions.py:70: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
{'loss': 2.4774, 'grad_norm': 17572.41796875, 'learning_rate': 1.56e-05, 'epoch': 12.81}
  warnings.warn(                                                                                                                      
{'eval_loss': 2.4285712242126465, 'eval_runtime': 2.6287, 'eval_samples_per_second': 534.104, 'eval_steps_per_second': 4.185, 'epoch': 12.81}
 70%|███████████████████████████████████████████████████████████████████▉                             | 42/60 [06:39<02:40,  8.92s/it]/home/sdowell/miniconda3/envs/thesis/lib/python3.13/site-packages/torch/nn/parallel/_functions.py:70: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
{'loss': 2.4742, 'grad_norm': 16954.5078125, 'learning_rate': 1.6800000000000002e-05, 'epoch': 13.81}
  warnings.warn(                                                                                                                      
{'eval_loss': 2.4223737716674805, 'eval_runtime': 2.6342, 'eval_samples_per_second': 532.985, 'eval_steps_per_second': 4.176, 'epoch': 13.81}
 75%|████████████████████████████████████████████████████████████████████████▊                        | 45/60 [07:07<02:13,  8.93s/it]/home/sdowell/miniconda3/envs/thesis/lib/python3.13/site-packages/torch/nn/parallel/_functions.py:70: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
{'loss': 2.4728, 'grad_norm': 17435.298828125, 'learning_rate': 1.8e-05, 'epoch': 14.81}
  warnings.warn(                                                                                                                      
{'eval_loss': 2.420717477798462, 'eval_runtime': 2.6283, 'eval_samples_per_second': 534.183, 'eval_steps_per_second': 4.185, 'epoch': 14.81}
 80%|█████████████████████████████████████████████████████████████████████████████▌                   | 48/60 [07:35<01:47,  8.95s/it]/home/sdowell/miniconda3/envs/thesis/lib/python3.13/site-packages/torch/nn/parallel/_functions.py:70: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
{'loss': 2.4694, 'grad_norm': 17715.845703125, 'learning_rate': 1.9200000000000003e-05, 'epoch': 15.81}
  warnings.warn(                                                                                                                      
{'eval_loss': 2.416862726211548, 'eval_runtime': 2.6656, 'eval_samples_per_second': 526.703, 'eval_steps_per_second': 4.127, 'epoch': 15.81}
 85%|██████████████████████████████████████████████████████████████████████████████████▍              | 51/60 [08:04<01:20,  8.92s/it]/home/sdowell/miniconda3/envs/thesis/lib/python3.13/site-packages/torch/nn/parallel/_functions.py:70: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
{'loss': 2.4652, 'grad_norm': 17019.728515625, 'learning_rate': 2.04e-05, 'epoch': 16.81}
  warnings.warn(                                                                                                                      
{'eval_loss': 2.4141862392425537, 'eval_runtime': 2.6569, 'eval_samples_per_second': 528.429, 'eval_steps_per_second': 4.14, 'epoch': 16.81}
 90%|███████████████████████████████████████████████████████████████████████████████████████▎         | 54/60 [08:32<00:53,  8.91s/it]/home/sdowell/miniconda3/envs/thesis/lib/python3.13/site-packages/torch/nn/parallel/_functions.py:70: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
{'loss': 2.4629, 'grad_norm': 16609.376953125, 'learning_rate': 2.16e-05, 'epoch': 17.81}
  warnings.warn(                                                                                                                      
{'eval_loss': 2.413912773132324, 'eval_runtime': 2.6444, 'eval_samples_per_second': 530.937, 'eval_steps_per_second': 4.16, 'epoch': 17.81}
 95%|████████████████████████████████████████████████████████████████████████████████████████████▏    | 57/60 [09:00<00:26,  8.93s/it]/home/sdowell/miniconda3/envs/thesis/lib/python3.13/site-packages/torch/nn/parallel/_functions.py:70: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
{'loss': 2.4621, 'grad_norm': 16785.427734375, 'learning_rate': 2.2800000000000002e-05, 'epoch': 18.81}
  warnings.warn(                                                                                                                      
{'eval_loss': 2.4138200283050537, 'eval_runtime': 2.6495, 'eval_samples_per_second': 529.904, 'eval_steps_per_second': 4.152, 'epoch': 18.81}
100%|█████████████████████████████████████████████████████████████████████████████████████████████████| 60/60 [09:25<00:00,  8.96s/it]/home/sdowell/miniconda3/envs/thesis/lib/python3.13/site-packages/torch/nn/parallel/_functions.py:70: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
{'loss': 2.4067, 'grad_norm': 16205.41796875, 'learning_rate': 2.4e-05, 'epoch': 19.81}
  warnings.warn(
100%|█████████████████████████████████████████████████████████████████████████████████████████████████| 60/60 [09:28<00:00,  9.48s/it]
[34m[1mwandb[0m: Adding directory to artifact (./runs/esm2_8m_student_distill_1)... Done. 0.0s                                     
{'eval_loss': 2.40134596824646, 'eval_runtime': 2.6556, 'eval_samples_per_second': 528.695, 'eval_steps_per_second': 4.142, 'epoch': 19.81}
{'train_runtime': 568.8128, 'train_samples_per_second': 263.32, 'train_steps_per_second': 0.105, 'train_loss': 2.475778659184774, 'epoch': 19.81}
***** train metrics *****
  epoch                    =    19.8136
  total_flos               =  5423235GF
  train_loss               =     2.4758
  train_runtime            = 0:09:28.81
  train_samples_per_second =     263.32
  train_steps_per_second   =      0.105
2025-05-12 02:32:44,108 INFO: Training complete.
/home/sdowell/miniconda3/envs/thesis/lib/python3.13/site-packages/torch/nn/parallel/_functions.py:70: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn(
100%|█████████████████████████████████████████████████████████████████████████████████████████████████| 11/11 [00:01<00:00,  5.68it/s]
***** eval metrics *****
  epoch                   =    19.8136
  eval_loss               =     2.4044
  eval_runtime            = 0:00:02.63
  eval_samples_per_second =    533.813
  eval_steps_per_second   =      4.182
Evaluation metrics: {'eval_loss': 2.404397487640381, 'eval_runtime': 2.6301, 'eval_samples_per_second': 533.813, 'eval_steps_per_second': 4.182, 'epoch': 19.8135593220339}
